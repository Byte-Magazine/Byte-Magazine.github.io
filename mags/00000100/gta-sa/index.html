<!doctype html>
<html lang="fa" dir="rtl" class="docs-wrapper plugin-docs plugin-id-mags docs-version-current docs-doc-page docs-doc-id-00000100/gta-sa/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">چگونه آپدیت ویندوز GTA: SA را خراب کرد؟ | نشریه‌ی علمی فرهنگی بایت</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://byte-mag.ir/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://byte-mag.ir/img/social-card.png"><meta data-rh="true" property="og:url" content="https://byte-mag.ir/mags/00000100/gta-sa/"><meta data-rh="true" property="og:locale" content="fa"><meta data-rh="true" name="docusaurus_locale" content="fa"><meta data-rh="true" name="docsearch:language" content="fa"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-mags-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-mags-current"><meta data-rh="true" property="og:title" content="چگونه آپدیت ویندوز GTA: SA را خراب کرد؟ | نشریه‌ی علمی فرهنگی بایت"><meta data-rh="true" name="description" content="بررسی فنی جعل موقعیت در GPS و پیامدهای آن بر خدمات شهری و زندگی روزمره مردم"><meta data-rh="true" property="og:description" content="بررسی فنی جعل موقعیت در GPS و پیامدهای آن بر خدمات شهری و زندگی روزمره مردم"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://byte-mag.ir/mags/00000100/gta-sa/"><link data-rh="true" rel="alternate" href="https://byte-mag.ir/mags/00000100/gta-sa/" hreflang="fa"><link data-rh="true" rel="alternate" href="https://byte-mag.ir/mags/00000100/gta-sa/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"00000100 (7 نوشته)","item":"https://byte-mag.ir/mags/00000100"},{"@type":"ListItem","position":2,"name":"چگونه آپدیت ویندوز GTA: SA را خراب کرد؟","item":"https://byte-mag.ir/mags/00000100/gta-sa/"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="نشریه‌ی علمی فرهنگی بایت RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="نشریه‌ی علمی فرهنگی بایت Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.48caaf13.css">
<script src="/assets/js/runtime~main.2604ea64.js" defer="defer"></script>
<script src="/assets/js/main.05477d58.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="/img/authors/hirbodbehnam.jpg"><div role="region" aria-label="پرش به مطلب اصلی"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">پرش به مطلب اصلی</a></div><nav aria-label="صفحه اصلی" class="theme-layout-navbar navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="باز و بست منو" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">نشریه‌ی علمی فرهنگی بایت</b></a><a class="navbar__item navbar__link" href="/mags/intro">آرشیو نشریه</a><a href="#" class="navbar__item navbar__link">وبلاگ (بزودی)</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/staff">اعضای مرکزی</a><a class="navbar__item navbar__link" href="/authors">نویسندگان</a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eExm"><div class="docsWrapper_hBAB"><button aria-label="بازگشت به بالا" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="نوار کناری مستندات" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mags/intro">شماره‌های منتشر شده</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mags/00000001">00000001 (8 نوشته)</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;00000001 (8 نوشته)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mags/00000010">00000010 (17 نوشته)</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;00000010 (17 نوشته)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mags/00000011">00000011 (8 نوشته)</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;00000011 (8 نوشته)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/mags/00000100">00000100 (7 نوشته)</a><button aria-label="بستن دسته بندی در نوار کناری &#x27;00000100 (7 نوشته)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mags/00000100/sarmaghale/">سرمقاله - در تار و پود فناوری</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mags/00000100/gta-sa/">چگونه آپدیت ویندوز GTA: SA را خراب کرد؟</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mags/00000100/be-yade-erfan/">به یاد عرفان</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mags/00000100/yadgiri-machine/">یادگیری ماشین</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mags/00000100/negah-digari-baraye-yadgiri-az-dadeha/">نگاه دیگری برای یادگیری از داده‌ها</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mags/00000100/filesystem-without-limit-on-inode/">فایل‌سیستمی بدون محدودیت تعداد inode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mags/00000100/story-of-hardwar/">داستان نبرد سخت</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mags/00000101">00000101 (7 نوشته)</a><button aria-label="باز کردن دسته بندی در نوار کناری &#x27;00000101 (7 نوشته)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="نشانگر صفحات"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="صفحه اصلی" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/mags/00000100"><span>00000100 (7 نوشته)</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">چگونه آپدیت ویندوز GTA: SA را خراب کرد؟</span></li></ul></nav><div class="theme-doc-markdown markdown"><div class="docAuthors_AnFi margin-bottom--md"><div class="docAuthor_y7l7"><img src="/img/authors/hirbodbehnam.jpg" alt="هیربد بهنام" class="docAuthorImg_vlJe"><div><div class="docAuthorName_aSh4">هیربد بهنام</div><div class="docAuthorTitle_Yp5_">کارشناسی ۱۳۹۹</div><div class="docAuthorSocials_M3ba"><a href="https://github.com/hirbodbehnam" target="_blank" rel="noopener noreferrer" class="docAuthorSocialLink_trj9"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://linkedin.com/in/hirbod-behnam-155a84206/" target="_blank" rel="noopener noreferrer" class="docAuthorSocialLink_trj9"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div></div></div></div><header><h1>چگونه آپدیت ویندوز GTA: SA را خراب کرد؟</h1></header>
<p>در یک روز زیبای زمستانی، مایکروسافت تصمیم گرفت که آپدیت 24H2 را برای تمامی کامپیوترهایی که ویندوز ۱۱ دارند منتشر کند. این آپدیت پشتیبانی از HDR، امکان باز کردن فایل‌های 7z و tar در Windows Explorer، دستور sudo در powershell و بهینه شدن مصرف باتری را به این سیستم‌عامل اضافه کرده بود. اما این آپدیت یک مشکل برای گیمر‌هایی که همچنان بازی نوستالژیک و محبوب Grand Theft Auto: San Andreas را بازی می‌کنند، به‌وجود آورد: هواپیمای آب‌نشین skimmer دیگر ساخته نمی‌شد. این مشکل به حدی بود که بازیکنان حتی نمی‌توانستند این هواپیما را به کمک
<span class="wrapper_CZBo"><span class="text_qqsc"><span><strong>کد تقلب</strong></span></span><span class="tooltip_lI6R undefined">cheat code</span></span>
در بازی بسازند.</p>
<div style="text-align:center"><p><img decoding="async" loading="lazy" src="/assets/images/skimmer-953f88b7d37a02b89e4b83c8d7d753ff.png" width="494" height="278" class="img_ev3q"></p></div>
<p>در این حین، برنامه‌نویس ماد Silent Patch -که یک ماد برای بهبود سری بازی‌های GTA III، GTA: VC و GTA: SA بر روی سیستم‌های جدید است- دست به کار شد که مشکل اصلی را پیدا و رفع کند. او قبلاً در Silent Patch با مشکلاتی نظیر سیاه شدن صفحه به‌هنگام خروج از ساختمان‌ها،</p>
<p><span class="wrapper_CZBo"><span class="text_qqsc"><span><strong>نشتی حافظه‌های</strong></span></span><span class="tooltip_lI6R undefined">memory leak</span></span>
مربوط به عکس گرفتن و مشکلات مربوط به چندمانیتوری دست‌و‌پنجه نرم کرده بود. برای این کار، او در ابتدا به کمک دو ماشین مجازی که یکی نسخهٔ‌ 23H2 و دیگری نسخهٔ 24H2 ویندوز ۱۱ بود، بررسی کرد که آیا واقعاً مشکل نسخهٔ ویندوز است یا خیر و او بعد از استفاده از ماشین‌های مجازی مطمئن شد که ویندوز یک مشکلی برای بازی ایجاد کرده‌است؛ چرا که بر روی نسخهٔ 23H2 ویندوز ۱۱ این مشکل وجود نداشت و هواپیمای skimmer هم در قسمت‌های مختلف نقشه وجود داشت و هم می‌توانست آن را به کمک کدهای تقلب بسازد.</p>
<p>او در ابتدا سعی کرد که در نسخهٔ بدون ماد بازی، هواپیمای skimmer را بسازد و CJ را داخل هواپیما قرار دهد. زمانی که او این کار را انجام داد، CJ به ارتفاع ۱۰۳۰ متری سطح زمین پرتاب شد که مطمئناً ارتفاع درستی برای هواپیما نیست. همچنین زمانی که او ماد Silent Patch را اجرا کرد CJ به بالا پرتاب نشد، بلکه بازی فریز شد و در نهایت کرش کرد.</p>
<div style="text-align:center"><p><img decoding="async" loading="lazy" src="/assets/images/skimmer2-7383ecc6538f13c5ab8ae91bf7035f57.png" width="494" height="278" class="img_ev3q"></p></div>
<p>سپس او شروع به دیباگ کردن بازی کرد که متوجه شود که مشکل چیست. در ابتدا او در تابعی که هواپیما را در محیط بازی قرار می‌دهد، یک break point گذاشت و متوجه شد که زمانی که بازی می‌خواهد سرعت چرخش پره‌های هواپیما را حساب کند ارتفاع هواپیما عددی در اردر 1030 است که منطقی نیست. پس دو احتمال وجود دارد:</p>
<ol>
<li>بازی به صورت اشتباهی هواپیما را در یک ارتفاع خیلی زیاد می‌سازد.</li>
<li>هواپیما واقعاً بر روی سطح زمین ساخته می‌شود ولی به دلیلی در آسمان پرتاب می‌شود.</li>
</ol>
<p>در ادامهٔ بررسی‌هایش او متوجه شد که تابعی به نام <code>CreateCarForScript</code> وجود دارد که وظیفهٔ آن ساختن یک وسیلهٔ نقلیه در نقطهٔ خاصی از نقشه است. در این تابع، خطی به صورت زیر وجود دارد:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">posZ </span><span class="token operator">+=</span><span class="token plain"> newVehicle</span><span class="token operator">-&gt;</span><span class="token function" style="color:rgb(80, 250, 123)">GetDistanceFromCentreOfMassToBaseOfModel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>همان طور که مشخص است این تکه کد، ارتفاع وسیلهٔ نقلیه را نسبت به مرکز ثقل آن افزایش می‌دهد. سپس او با بررسی داخل تابع <code>GetDistanceFromCentreOfMassToBaseOfModel</code>  متوجه شد که در  bouding box این هواپیما این مقادیر وجود دارند:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">- *(RwBBox**)0x00B2AC48   RwBBox *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - sup    RwV3d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      x    -5.39924574     float</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      y    -6.77431822     float</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      z    -4.30747210e+33 float</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - inf    RwV3d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      x    5.42313004 float</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      y    4.02343750 float</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      z    1.87021971 float</span><br></span></code></pre></div></div>
<p>در بازی‌ها bouding box به مکعبی گفته می‌شود که کل یک شئ درون بازی را در بر می‌گیرد. همان طور که مشخص است مقدار محور عمودی این هواپیما خیلی عدد درستی نیست. اما این موضوع عجیب است چرا که این عدد نه اولین عدد این
<span class="wrapper_CZBo"><span class="text_qqsc"><span><strong>ساختار</strong></span></span><span class="tooltip_lI6R undefined">structure</span></span>
است و نه آخرین عدد و اعداد کنار آن هم دست نخورده باقی‌مانده‌اند. پس یک نوع memory corruption عجیب داریم که فقط وسط یک ساختار را دست می‌زند. با بررسی بیشتر و چک کردن هر تکه کد که مقدار این bouding box را عوض می‌کند، او متوجه شد که در ابتدا که هواپیما داده‌هایش را از دیسک لود می‌کند، مقدار ارتفاع bouding box (همان z) درست است ولی بعد از مدتی خراب می‌شود. با بررسی بیشتر می‌توان متوجه شد که تابعی به نام <code>SetupSuspensionLines</code> وجود دارد که مسئولیت مقداردهی اولیه فنربندی هر وسیلهٔ نقلیه را دارد. در این تابع کدی به صورت زیر وجود دارد:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">colModel</span><span class="token operator">-&gt;</span><span class="token plain">bbox</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">z </span><span class="token operator">=</span><span class="token plain"> pSuspensionLines</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">p1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre></div></div>
<p>مقدار bbox.sup.z همان مقدار محور z مربوط به bounding box است. از آنجایی که این مقدار زمان اجرا غلط است، پس می‌توان نتیجه گرفت که مقدار <code>pSuspensionLines[0].p1.z</code> به کل اشتباه است. این مقدار از فایلی به نام <code>vehicles.ide</code> خوانده می‌شود که اطلاعات چرخ‌های هر وسیله نقلیهٔ بازی را در خودش دارد. در صورتی که خط مربوط به هواپیمای skimmer را مشاهده کنیم اطلاعات زیر را می‌بینیم:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token number">460</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">skimmer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">skimmer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">plane</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">SEAPLANE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">SKIMMER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">ignore</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">   </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">   </span><span class="token number">0</span><br></span></code></pre></div></div>
<p>اما در صورتی که خط مربوط به یک هواپیمای دیگر مانند rustler را نگاه کنیم، متوجه می‌شویم که در آخر این خط چندین پارامتر دیگر نیز وجود دارند:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token number">476</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rustler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rustler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> plane</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> RUSTLER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> RUSTLER</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rustler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ignore</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0.6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0.3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><br></span></code></pre></div></div>
<p>پارامترهای آخر خط که در هواپیمای skimmer وجود ندارند، مربوط به اندازهٔ چرخ‌های هر هواپیما هستند. نکته‌ای که وجود دارد این است که قایق‌ها این پارامترها را ندارند؛ چرا که قایق‌ها چرخ ندارند. در این‌جا هم از آن‌جایی که skimmer چرخ ندارد و یک هواپیمای آب‌نشین محسوب می‌شود، این پارامتر‌ها کلاً وجود ندارند! همچنین در بازی GTA: Vice City هواپیمای skimmer واقعاً به‌عنوان یک قایق در دیتای بازی وجود داشت، ولی در بازی GTA: San Andreas این هواپیما از قایق تبدیل به هواپیما شده‌است! اما از شانس بد برنامه‌نویسان rockstar و از آن‌جایی که skimmer یک هواپیماست که چرخ ندارد، خالی گذاشتن فیلد‌های مربوط به چرخ‌ها باعث شده‌است که در کد بازی
<span class="wrapper_CZBo"><span class="text_qqsc"><span><strong>رفتار نامشخص</strong></span></span><span class="tooltip_lI6R undefined">undefined behavior</span></span>
رخ دهد و مقدار bounding box اشتباه شود که باعث می‌شود هواپیما در ارتفاع خیلی زیاد ساخته شود. در صورتی که مقادیر مربوط به چرخ‌های یک هواپیما‌ی دیگر را به skimmer بدهیم، می‌بینیم که skimmer دوباره به بازی بر می‌گردد و بدون هیچ مشکلی می‌توان با آن پرواز کرد!</p>
<div style="text-align:center"><p><img decoding="async" loading="lazy" src="/assets/images/skimmer3-e2290206e1ed45980d6231ec41368b21.png" width="494" height="268" class="img_ev3q"></p></div>
<p>اما یک سؤال مهم دیگر در این‌جا وجود دارد: چرا این باگ زمانی خودش را نشان داد که ویندوز ۱۱ نسخهٔ 24H2 خودش را منتشر کرد و در ۲۱ سال گذشته خودش را نشان نداده بود؟ برای این کار باید در ابتدا کدی که مربوط به خواندن اطلاعات چرخ‌ها از فایل <code>vehicles.ide</code> است را نگاه کنیم. این کد به‌صورت زیر است:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> CFileLoader</span><span class="token operator">::</span><span class="token function" style="color:rgb(80, 250, 123)">LoadVehicleObject</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token operator">*</span><span class="token plain"> line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> objID </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> modelName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">24</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> texName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">24</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> handlingID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> gameName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> anims</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token plain"> vehClass</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> frq</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> flags</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> comprules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> wheelModelID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Uninitialized!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">float</span><span class="token plain"> frontWheelScale</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rearWheelScale</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Uninitialized!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> wheelUpgradeClass </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Funny enough, this one IS initialized</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">sscanf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;%d %s %s %s %s %s %s %s %d %d %x %d %f %f %d&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">&amp;</span><span class="token plain">objID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> modelName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> texName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> handlingID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> gameName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            anims</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> vehClass</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">frq</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">flags</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">comprules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">wheelModelID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token operator">&amp;</span><span class="token plain">frontWheelScale</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">rearWheelScale</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">wheelUpgradeClass</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// More processing here...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>همان‌طور که مشخص است، متغیرهای <code>frontWheelScale</code> و <code>rearWheelScale</code> مقداردهی اولیه نشده‌اند و از آن‌جا که از تابع <code>sscanf</code> برای خواندن این اعداد استفاده می‌شود، در صورتی که عددی در رشته وجود نداشته باشد مقدار متغیر پاس‌داده‌شده به <code>sscanf</code> نیز عوض نمی‌شود. اما هنوز این سؤال مطرح است که چرا فقط در آخرین نسخهٔ ویندوز ۱۱ این اعداد به صورتی مقداردهی می‌شوند که بازی نمی‌تواند هواپیمای skimmer را بسازد. به‌عنوان یک فرض اولیه می‌توان به این موضوع فکر کرد که شاید ویندوز کتابخانهٔ <code>libc</code> که شامل توابعی مانند <code>printf</code> و <code>fopen</code> و <code>sscanf</code> است را طوری عوض‌ کرده‌است که باعث بشود این تغییر اتفاق بیفتد، اما نکته‌ای که وجود دارد این است که GTA: SA یک برنامهٔ statically linked است و از کتابخانهٔ <code>libc</code> خود سیستم‌عامل استفاده نمی‌کند؛ بلکه کتابخانهٔ libc مربوط به خودش را دارد که بین نسخه‌های مختلف ویندوز تغییر نمی‌کند. پس مشکل از جای دیگری است. در ادامه، اگر نگاه کنیم که چه تابعی <code>LoadVehicleObject</code> را صدا می‌‌زند به تابع زیر می‌رسیم:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> CFileLoader</span><span class="token operator">::</span><span class="token function" style="color:rgb(80, 250, 123)">LoadObjectTypes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">char</span><span class="token operator">*</span><span class="token plain"> filename</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// Open the file...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">line </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">fgets</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(189, 147, 249)">NULL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Parse the section indicators...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">section</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// Different sections...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> SECTION_CARS</span><span class="token operator">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">LoadVehicleObject</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>همان‌طور که مشاهده می‌کنید، در یک حلقه هر خط از فایل خوانده می‌شود و سپس تابع <code>LoadVehicleObject</code> صدا زده می‌شود. این کد و نحوهٔ صدا شدن توابع باعث می‌شود که متغیرهای <code>frontWheelScale</code> و <code>rearWheelScale</code> از اجرای تابع قبلی به این تابع منتقل شوند. دلیل این موضوع این است که زمانی که یک تابع تمام می‌شود، مقادیر داخل استک آن پاک (صفر) نمی‌شوند و صرفاً stack pointer جا‌به‌جا می‌شود. این موضوع باعث می‌شود که اگر دوباره همان تابع را فوراً بعد از تمام شدن آن صدا کنیم، تمامی متغیر‌های آن تابع مقدار اولیهٔ متغیر‌های فراخوانی قبلی تابع را داشته باشند. اما مشخص است که اگر تابع دیگری بین این دو فراخوانی اجرا شود، استک به‌جا‌ماندهٔ تابع اول را overwrite می‌کند. در بازی GTA نیز بین هر صدا زدن تابع <code>LoadVehicleObject</code> یک‌ بار تابع <code>fgets</code> صدا زده می‌شود. پس می‌توان حدس زد که در نسخه‌های قبلی ویندوز تابع <code>fgets</code> استفادهٔ زیادی از استک نداشته و به همین دلیل مقدار <code>frontWheelScale</code> و <code>rearWheelScale</code> از فراخوانی قبلی تابع به جا می‌مانند. به همین منظور در صورتی که مقدار این دو متغیر را در                                                   نسخه‌های قبلی ویندوز نگاه کنید، به عدد 0.7 می‌رسید،                                                                چرا که دقیقاً در خط قبلی فایل  که خوانده‌                                                                                           شده‌است، اطلاعات مربوط به ماشین Top Fun                                                                                                       وجود دارد که <code>rearWheelScale</code> آن برابر 0.7 است!                                                                         پس قطعاً این عدد از فراخوانی قبلی به جا مانده‌است.</p>
<div style="text-align:left"><p><img decoding="async" loading="lazy" src="/assets/images/cj-d887f662a74e9d05ee6e5dae64f1cb15.png" width="364" height="460" class="img_ev3q"></p></div>
<p>حال باید بررسی کنیم که در نسخهٔ 24H4 ویندوز چه اتفاقی می‌افتد که این عدد خراب می‌شود. برای این کار می‌توان یک hardware breakpoint بر روی متغیر درون استک قرار داد تا زمانی که آن نوشته می‌شود، دیباگر برنامه را متوقف کند. زمانی که این کار را می‌کنیم، متوجه می‌شویم که دیباگر در فراخوانی تابع <code>LeaveCriticalSection</code> که یک تابع مخصوص سیستم‌عامل است، متوقف می‌شود. این بدین معناست که پیاده‌سازی <code>LeaveCriticalSection</code> در ویندوز ۱۱ نسخهٔ 24H4 طوری عوض‌ شده‌است که از استک بیشتری استفاده می‌کند و در نتیجه متغیرهایی که از فراخوانی قبلی تابع در استک به جا مانده‌اند، overwrite می‌شوند. می‌توانید نحوهٔ صدا زده شدن توابع را در ادامه مشاهده کنید:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; ntdll.dll!_RtlpAbFindLockEntry@4()	Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ntdll.dll!_RtlAbPostRelease@8()	Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ntdll.dll!_RtlLeaveCriticalSection@4()	Unknown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  gta_sa.exe!fgets()	Unknown</span><br></span></code></pre></div></div>
<p>شاید جالب باشد اگر بدانید که GTA: SA تنها بازی‌ای نیست که این مشکل گریبان‌گیرش شده‌است. بلکه بازی قدیمی                                                                Sid Meier&#x27;s Alpha Centauri نیز (دقیقاً به همین دلیل که در نسخه‌های جدیدتر ویندوز <code>LeaveCriticalSection</code> فضای بیشتری از استک را اشغال می‌کند) کرش می‌کند! در نهایت نیز یک پیشنهادی که می‌توانم به شما بکنم این است که حتماً حتماً حواستان به رفتارهای نامشخص از این قبیل باشد و حتماً در صورتی که کامپایلر به شما
<span class="wrapper_CZBo"><span class="text_qqsc"><span><strong>اخطار</strong></span></span><span class="tooltip_lI6R undefined">warning</span></span>
داد، این اخطار را نادیده نگیرید و به حرف آن گوش کنید!</p>
<blockquote>
<p><a href="https://cookieplmonster.github.io/2025/04/23/gta-san-andreas-win11-24h2-bug" target="_blank" rel="noopener noreferrer">منبع</a></p>
</blockquote>
<div style="text-align:left"><p><img decoding="async" loading="lazy" src="/assets/images/cj2-a4cf7b4c133828d394bbe216834f181a.png" width="698" height="508" class="img_ev3q"></p></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>برچسب‌ها:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/mags/tags/os">OS</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/mags/tags/bug-hunting">Bug Hunting</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/mags/tags/game">Game</a></li></ul></div></div><br><div style="border-top:2px solid #ccc;padding-top:20px;margin-top:10px" class="giscus-container"></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="صفحات مستندات"><a class="pagination-nav__link pagination-nav__link--prev" href="/mags/00000100/sarmaghale/"><div class="pagination-nav__sublabel">قبلی</div><div class="pagination-nav__label">سرمقاله - در تار و پود فناوری</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mags/00000100/be-yade-erfan/"><div class="pagination-nav__sublabel">بعدی</div><div class="pagination-nav__label">به یاد عرفان</div></a></nav></div></div></div></div></main></div></div></div><footer class="footer_d1NW" role="contentinfo"><div class="topRow_Kw87"><div><h3 class="title_R8t4">ارتباط با ما</h3><div class="contactLinks_Ri0r"><a class="link_scak" href="mailto:bytepublication@gmail.com"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"></path></svg><span>bytepublication@gmail.com</span></a><a class="link_scak" href="https://docs.google.com/forms/d/e/1FAIpQLSfjtbcWu6cLSklvKAXpqJ0P0tm4yis5t9VN_C0PsCptgpDAxQ/viewform" target="_blank" rel="noopener noreferrer" style="flex-direction:row-reverse"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 40c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm144 418c0 3.3-2.7 6-6 6H54c-3.3 0-6-2.7-6-6V118c0-3.3 2.7-6 6-6h42v36c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-36h42c3.3 0 6 2.7 6 6z"></path></svg><span>عضویت در نشریه</span></a></div></div><div><h3 class="title_R8t4">ما را دنبال کنید</h3><div class="socialLinks_R943"><a class="link_scak" href="https://t.me/byte_mag" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg><span>Telegram</span></a><a class="link_scak" href="https://github.com/Byte-Magazine" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><span>GitHub</span></a><a class="link_scak" href="https://www.linkedin.com/company/byte-publication/" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><span>LinkedIn</span></a><a class="link_scak" href="https://twitter.com/BytePublication" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><span>Twitter</span></a></div></div></div><div class="divider_NBTE"></div><div class="copy_kvc_">© نشریه‌ی علمی فرهنگی بایت - دانشکده مهندسی کامپیوتر - دانشگاه صنعتی شریف</div></footer></div>
</body>
</html>